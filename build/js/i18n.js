!function(t){"use strict";var r={},e=function(){};r.AuditorBase=e,e.KEY_USE=0,e.KEY_MISS=1,e.KEY_INVALID=2,e.PLURALIZER_MISS=3,e.KEYWORD_MISS=4;var o=function(){};r.NullAuditor=o,o.prototype.log=function(t,r){};var n=function(){this._forms=[]};r.PluralizerBase=n,n.FORM_ZERO="zero",n.FORM_ONE="one",n.FORM_TWO="two",n.FORM_FEW="few",n.FORM_MANY="many",n.FORM_OTHER="other",n.prototype.getForm=function(t){throw new Error("Method is not implemented")},n.prototype.getFormIdx=function(t){return this._forms.indexOf(this.getForm(t))};var i=function(){n.call(this),this._forms=[n.FORM_ONE,n.FORM_OTHER]};r.English=i,i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.getForm=function(t){return 1==t?n.FORM_ONE:n.FORM_OTHER};var a=function(){n.call(this),this._forms=[n.FORM_ONE,n.FORM_FEW,n.FORM_MANY,n.FORM_OTHER]};r.Russian=a,a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.getForm=function(t){if(t%1!=0)return n.FORM_OTHER;var r=t%10,e=t%100;return 1==r&&11!=e?n.FORM_ONE:r>=2&&4>=r&&(12>e||e>14)?n.FORM_FEW:0==r||r>=5&&9>=r||e>=11&&14>=e?n.FORM_MANY:n.FORM_OTHER};var l=function(t){if(this._defaultLang=t||"en",this._pluralizers={ru:a,en:i,it:i},!this._pluralizers[this._defaultLang])throw new Error("Unable to lookup pluralizer for fallback language "+this._defaultLang)};r.PluralizerFactory=l,l.prototype.getPluralizer=function(t){return new this._pluralizers[t]},l.prototype.getDefaultPluralizer=function(){return new this._pluralizers[this._defaultLang]},l.prototype.addPluralizer=function(t,r){this._pluralizers[t]=r};var u=function(){this._storage={}};r.KeyValueStorage=u,u.prototype.get=function(t){var r=this._storage[this._buildKey(t)];return void 0===r||null===r?null:r},u.prototype.set=function(t){this._storage[this._buildKey(t)]=t.translation},u.prototype.remove=function(t){delete this._storage[this._buildKey(t)]},u.prototype.batchSet=function(t){for(var r=0;r<t.length;++r)this.set(t[r])},u.prototype.batchDelete=function(t){for(var r=0;r<t.length;++r)this.remove(t[r])},u.prototype._buildKey=function(t){return t.lang+"/"+t.sectionId+"/"+t.key};var s=function(t,r,e){this.key=t,this.lang=r,this.sectionId=e||0};r.TranslationId=s;var p=function(t,r,e,o){s.call(this,r,e,o),this.translation=t};r.Translation=p,p.prototype=Object.create(s.prototype),p.prototype.constructor=p;var h=function(t,r,e){this._storage=t,this._pluralizerFactory=r,this._auditor=e,this._pluralizers={}};r.I18nService=h,h.prototype.translate=function(t,r){if(r=r||{},!this._checkKey(t.key))return this._auditor.log(t,e.KEY_INVALID),"";var o=this._storage.get(t);if(null===o)return this._auditor.log(t,e.KEY_MISS),t.key;this._auditor.log(t,e.KEY_USE);var n=0;for(var i in r)n++;return 0==n?o:this._interpolate(t,o,r)},h.prototype.isExist=function(t){return null!=this._storage.get(t)},h.prototype._checkKey=function(t){return null!=t.match(/^[a-z0-9.#={}\[\]\-]+$/)},h.prototype._interpolate=function(t,r,e){var o=[],n=[];for(var i in e)o.push("%{"+i+"}"),n.push(e[i]);for(var a,l=[],u=new RegExp("%{(\\w+)?(?:\\s*,\\s*(\\w+))?\\s*->\\s*([^}]*)}","g");a=u.exec(r);)l.push(a);if(l)for(var s=this._getPluralizer(t),p=0;p<l.length;++p)o.push(l[p][0]),n.push(this._resolveOperator(t,s,l[p],e));for(var h=0;h<o.length;++h)r=r.replace(o[h],n[h]);return r},h.prototype._getPluralizer=function(t){return null==this._pluralizers[t.lang]&&(this._pluralizers[t.lang]=this._pluralizerFactory.getPluralizer(t.lang)),null==this._pluralizers[t.lang]&&(this._auditor.log(t,e.PLURALIZER_MISS),this._pluralizers[t.lang]=this._pluralizerFactory.getDefaultPluralizer()),this._pluralizers[t.lang]},h.prototype._resolveOperator=function(t,r,o,n){var i={count:o[1],sex:o[2],text:o[3]},a=i.text.split(","),l=0;null==i.count?l=0:n.hasOwnProperty(i.count)?(l=r.getFormIdx(n[i.count]),a.hasOwnProperty(l.toString())||(l=0)):(this._auditor.log(t,e.KEY_MISS),l=0);var u=a[l].split("|"),s=0;return null==i.sex?s=0:n.hasOwnProperty(i.sex)?(s=n[i.sex],u.hasOwnProperty(s.toString())||(s=0)):s=0,u[s]},t.vda=t.vda||{},t.vda.i18n=r,"function"==typeof define&&define.amd&&define("vda/i18n",function(){return r})}(this);