!function(t){"use strict";var r={},s=function(){};(r.AuditorBase=s).KEY_USE=0,s.KEY_MISS=1,s.KEY_INVALID=2,s.PLURALIZER_MISS=3,s.KEYWORD_MISS=4;var e=function(){};(r.NullAuditor=e).prototype.log=function(t,r){};var o=function(){this._forms=[]};(r.PluralizerBase=o).FORM_ZERO="zero",o.FORM_ONE="one",o.FORM_TWO="two",o.FORM_FEW="few",o.FORM_MANY="many",o.FORM_OTHER="other",o.prototype.getForm=function(t){throw new Error("Method is not implemented")},o.prototype.getFormIdx=function(t){return this._forms.indexOf(this.getForm(t))};var n=function(){o.call(this),this._forms=[o.FORM_ONE,o.FORM_OTHER]};(((r.English=n).prototype=Object.create(o.prototype)).constructor=n).prototype.getForm=function(t){return 1==t?o.FORM_ONE:o.FORM_OTHER};var i=function(){o.call(this),this._forms=[o.FORM_ONE,o.FORM_FEW,o.FORM_MANY,o.FORM_OTHER]};(((r.Russian=i).prototype=Object.create(o.prototype)).constructor=i).prototype.getForm=function(t){if(t%1!=0)return o.FORM_OTHER;var r=t%10,e=t%100;return 1==r&&11!=e?o.FORM_ONE:2<=r&&r<=4&&(e<12||14<e)?o.FORM_FEW:0==r||5<=r&&r<=9||11<=e&&e<=14?o.FORM_MANY:o.FORM_OTHER};var a=function(t){if(this._defaultLang=t||"en",this._pluralizers={ru:i,en:n,it:n},!this._pluralizers[this._defaultLang])throw new Error("Unable to lookup pluralizer for fallback language "+this._defaultLang)};(r.PluralizerFactory=a).prototype.getPluralizer=function(t){return null==this._pluralizers[t]?null:new this._pluralizers[t]},a.prototype.getDefaultPluralizer=function(){return new this._pluralizers[this._defaultLang]},a.prototype.addPluralizer=function(t,r){this._pluralizers[t]=r};var l=function(){this._storage={}};(r.KeyValueStorage=l).prototype.get=function(t){var r=this._storage[this._buildKey(t)];return null==r?null:r},l.prototype.set=function(t){this._storage[this._buildKey(t)]=t.translation},l.prototype.remove=function(t){delete this._storage[this._buildKey(t)]},l.prototype.batchSet=function(t){for(var r=0;r<t.length;++r)this.set(t[r])},l.prototype.batchDelete=function(t){for(var r=0;r<t.length;++r)this.remove(t[r])},l.prototype._buildKey=function(t){return t.lang+"/"+t.sectionId+"/"+t.key};var u=function(t,r,e){this.key=t,this.lang=r,this.sectionId=e||0};r.TranslationId=u;var p=function(t,r,e,o){u.call(this,r,e,o),this.translation=t};((r.Translation=p).prototype=Object.create(u.prototype)).constructor=p;var h=function(t,r,e){this._storage=t,this._pluralizerFactory=r,this._auditor=e,this._pluralizers={}};(r.I18nService=h).prototype.translate=function(t,r){if(r=r||{},!this._checkKey(t.key))return this._auditor.log(t,s.KEY_INVALID),"";var e=this._storage.get(t);if(null===e)return this._auditor.log(t,s.KEY_MISS),t.key;this._auditor.log(t,s.KEY_USE);var o=0;for(var n in r)o++;return 0==o?e:this._interpolate(t,e,r)},h.prototype.isExist=function(t){return null!=this._storage.get(t)},h.prototype._checkKey=function(t){return null!=t.match(/^[a-z0-9.#={}\[\]\-]+$/)},h.prototype._interpolate=function(t,r,e){var o,n=[],i=[];for(var a in e)n.push("%{"+a+"}"),i.push(e[a]);for(var l=[],u=new RegExp("%{(\\w+)?(?:\\s*,\\s*(\\w+))?\\s*->\\s*([^}]*)}","g");o=u.exec(r);)l.push(o);if(l)for(var s=this._getPluralizer(t),p=0;p<l.length;++p)n.push(l[p][0]),i.push(this._resolveOperator(t,s,l[p],e));for(var h=0;h<n.length;++h)r=r.replace(n[h],i[h]);return r},h.prototype._getPluralizer=function(t){return null==this._pluralizers[t.lang]&&(this._pluralizers[t.lang]=this._pluralizerFactory.getPluralizer(t.lang)),null==this._pluralizers[t.lang]&&(this._auditor.log(t,s.PLURALIZER_MISS),this._pluralizers[t.lang]=this._pluralizerFactory.getDefaultPluralizer()),this._pluralizers[t.lang]},h.prototype._resolveOperator=function(t,r,e,o){var n={count:e[1],sex:e[2],text:e[3]},i=n.text.split(","),a=0;null==n.count?a=0:o.hasOwnProperty(n.count)?(a=r.getFormIdx(o[n.count]),i.hasOwnProperty(a.toString())||(a=0)):(this._auditor.log(t,s.KEY_MISS),a=0);var l=i[a].split("|"),u=0;return null==n.sex?u=0:o.hasOwnProperty(n.sex)?(u=o[n.sex],l.hasOwnProperty(u.toString())||(u=0)):u=0,l[u]},t.vda=t.vda||{},t.vda.i18n=r,"function"==typeof define&&define.amd&&define("vda/i18n",function(){return r})}(this);